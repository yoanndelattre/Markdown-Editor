steps:

- id: "Copy robots.txt file"
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', "gs://analytics_markdown-box-config/robots.txt", "./public/"]

- id: "Copy sitemap.xml file"
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', "gs://analytics_markdown-box-config/sitemap.xml", "./public/"]

- id: "install dependency"
  name: 'gcr.io/cloud-builders/npm'
  args: ['install']

- id: "Unit Test"
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'test']

- id: "Build static files"
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'build']

- id: "Download Express server"
  name: 'gcr.io/cloud-builders/git'
  args: ['clone', 'https://source.developers.google.com/p/markdown-236511/r/github_yoanndelattre_express-server-gcp', './master/github_yoanndelattre_express-server-gcp']

- id: "Create app_files folder"
  name: 'ubuntu'
  args: ['bash', './master/github_yoanndelattre_express-server-gcp/deploy/CreateFolderApp.sh']

- id: "Move Website Markdown Project folder"
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['rsync', '-d', '-r', './build/.', './master/github_yoanndelattre_express-server-gcp/app_files/']

- id: "Move WebsiteMarkdownConfigAppEngine.yaml in github_yoanndelattre_express-server-gcp folder"
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['mv', './deploy/WebsiteMarkdownConfigAppEngine.yaml', './master/github_yoanndelattre_express-server-gcp/']

- id: "DEPLOY APP ENGINE"
  name: 'gcr.io/cloud-builders/gcloud'
  args: ['app', 'deploy', './master/github_yoanndelattre_express-server-gcp/WebsiteMarkdownConfigAppEngine.yaml', './deploy/dispatch.yaml', '--version=1']
